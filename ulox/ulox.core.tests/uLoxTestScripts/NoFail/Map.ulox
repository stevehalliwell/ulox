build bind "StandardClassesLibrary";

test MapTests
{
    testcase ReadNonExistent
    {
        var key = "key";
        var result = 0;
        var m = Map(key);

        result = m.Read(key);

        Assert.IsNull(result);
    }

    testcase UpdateNonExistent
    {
        var key = "key";
        var initial = "value";
        var result = 0;
        var m = Map(key);

        result = m.Update(key, initial);

        Assert.IsFalse(result);
    }

    testcase ReadCreatedString
    {
        var key = "key";
        var expected = "value";
        var result = 0;
        var m = Map(key);

        m.Create(key, expected);
        result = m.Read(key);

        Assert.AreEqual(expected, result);
    }

    testcase CreatedDuplicateString
    {
        var key = "key";
        var initial = "value";
        var result = 0;
        var m = Map(key);

        m.Create(key, initial);
        result = m.Create(key, initial);

        Assert.IsFalse(result);
    }

    testcase ReadUpdatedString
    {
        var key = "key";
        var initial = "value";
        var expected = "changed";
        var result = 0;
        var m = Map(key);
        m.Create(key, initial);

        m.Update(key, expected);
        result = m.Read(key);

        Assert.AreEqual(expected, result);
    }

    testcase ReadDeletedString
    {
        var key = "key";
        var initial = "value";
        var result = 0;
        var m = Map(key);
        m.Create(key, initial);

        m.Delete(key);
        result = m.Read(key);

        Assert.IsNull(result);
    }

    testcase CountAfterCreation
    {
        var key = "key";
        var initial = "value";
        var result = 0;
        var expected = 1;
        var m = Map(key);

        m.Create(key, initial);
        result = m.Count();

        Assert.AreEqual(expected, result);
    }

    testcase CorrectlyRetrieveString
    {
        var key = "key";
        var initial = "value";
        var expected = "value5";
        var result = 0;
        var m = Map(key);
        
        for(var i = 0; i < 10; i+= 1)
        {
            m.Create(key+str(i), initial+str(i));
        }
        result = m.Read(key+str(5));

        Assert.AreEqual(expected, result);
    }

    testcase ManyAddedRetrieveMissingString
    {
        var key = "key";
        var initial = "value";
        var expected = null;
        var result = 0;
        var m = Map(key);
        
        for(var i = 0; i < 10; i+= 1)
        {
            m.Create(key+str(i), initial+str(i));
        }
        result = m.Read(key+str(11));

        Assert.AreEqual(expected, result);
    }
}